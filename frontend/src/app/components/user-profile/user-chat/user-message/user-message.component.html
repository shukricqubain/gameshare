<div class="child-component">
    <div class="column-container">
        <div class="header-container">
            <h1>Chat with {{otherUser}}</h1>
        </div>
        <div *ngIf="!messagesLoaded" class="loading-container">
            <mat-spinner [diameter]="100"></mat-spinner>
        </div>
        <div *ngIf="messagesLoaded" class="messages-container">
            <div [ngSwitch]="userMessages.length > 0" style="width: inherit;">
                <div *ngSwitchCase="false">
                    <p style="text-align: center;">Currently no messages.</p>
                </div>
                <div *ngSwitchCase="true" fxLayout="column" fxLayoutGap="10px" style="width: inherit;">
                    <div *ngFor="let message of userMessages">
                        <div [ngSwitch]="message.userIDSentMessage == user.userID">
                            <div *ngSwitchCase="true">
                                <div class="sent-message-container">
                                    <div *ngIf="message.messageImageFileName" (click)="editImageMessage(message)">
                                        <img src="{{message.messageImageFileName}}" class="sent-image-style">
                                    </div>
                                    <mat-card *ngIf="!message.messageImageFileName" class="sent-message-card" (click)="editUserMessage(message)">
                                        <mat-card-content>
                                            {{message.userMessage}}
                                        </mat-card-content>
                                    </mat-card>
                                    <div class="sent-timestamp-style">
                                        <p *ngIf="message.isRead == 1 && message.isEdit != 1 && message.userIDReceivedMessage != user.userID" style="margin-right: 10px;">Read</p>
                                        <p *ngIf="message.isEdit == 1" style="margin-right: 10px;">Edited at</p>
                                        <p>{{prepareMessageDate(message)}}</p>
                                    </div>
                                </div>
                            </div>
                            <div *ngSwitchCase="false">
                                <div class="received-message-container">
                                    <div *ngIf="message.messageImageFileName">
                                        <img src="{{message.messageImageFileName}}" class="received-image-style">
                                    </div>
                                    <mat-card *ngIf="!message.messageImageFileName" class="received-message-card">
                                        <mat-card-content>
                                            {{message.userMessage}}
                                        </mat-card-content>
                                    </mat-card>
                                    <div class="received-timestamp-style">
                                        <p *ngIf="message.isRead == 1 && message.isEdit != 1 && message.userIDReceivedMessage != user.userID" style="margin-right: 10px;">Read at</p>
                                        <p *ngIf="message.isEdit == 1" style="margin-right: 10px;">Edited at</p>
                                        <p>{{prepareMessageDate(message)}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mat-elevation-z8" [ngClass]="{'send-message-container': !isEdit,'edit-message-container': isEdit}">
            <app-image-upload (loadImageEvent)="loadImageEvent($event)"  [assetLocation]="assetLocation"></app-image-upload>
            <form [formGroup]="userMessageForm">
                <mat-form-field appearance="fill" class="input-style">
                    <div [ngSwitch]="isEdit">
                        <label *ngSwitchCase="false">Message</label>
                        <label *ngSwitchCase="true">Edit Message</label>
                    </div>
                    <input matInput name="userMessage" id="userMessage" type="text" formControlName="userMessage"
                        placeholder="Enter your message" [maxlength]="255" />
                </mat-form-field>
            </form>
            <button type="button" [disabled]="!userMessageForm.valid || !userMessageForm.dirty"
                matTooltip="Click to send a message." mat-icon-button (click)="onSubmit()">
                <mat-icon [ngClass]="{
                    'send-icon-style': userMessageForm.valid && userMessageForm.dirty && !isEdit,
                    'edit-icon-style': userMessageForm.valid && userMessageForm.dirty && isEdit,
                    'disabled-icon-style': !userMessageForm.valid}">
                    send
                </mat-icon>
            </button>
        </div>
    </div>
</div>